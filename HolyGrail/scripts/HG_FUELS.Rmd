---
title: "holygrail_fuels"
author: "Ashley Grupenhoff"
date: "10/22/2020"
output: html_document
---

```{r setup, include=FALSE}

  ### merge fine fuels, cwd, and average litter/duff
  


  ###Merged fine fuels & CWD data
  HG_finefuels <- read.csv("HolyGrail/data/raw/CPFMP_HolyGrail_FineFuels_Merge.csv")
  HG_CWD <- read.csv("HolyGrail/data/raw/CPFMP_HolyGrail_CWD_Merge.csv")  

```
```{r}

```



## 2020 post Springs fire fuels

Initial fuels data 

0-3" = (11.64 * n * d^2 * s * a * c)/ (Nl)
CWD = (11.64 * n * sum(d^2) * s * a * c)/ (Nl)

slope correction = (1+(presprings_fuelslope/100)^2)^(1/2)
convert sq cm to sq in: * 0.155

```{r}
#load data
getwd()
HG_CWD <- read.csv("C:/Users/ashle/Documents/R/RX_Fire_Monitoring/RX_Fire_Monitoring/HolyGrail/data/raw/HolyGrail_CWD.csv", stringsAsFactors = FALSE)
HG_FWD <- read.csv("C:/Users/ashle/Documents/R/RX_Fire_Monitoring/RX_Fire_Monitoring/HolyGrail/data/raw/HolyGrail_FineFuels.csv", stringsAsFactors=FALSE)
                 HG_FWD <- HG_FWD %>% 
                     mutate_at(vars(count_x1h, count_x10h, count_x100h, duff1_cm, duff2_cm, litter1_cm, litter2_cm, slope_percent, fuel1_cm, fuel2_cm), ~as.numeric(as.character(.)))
location_treatment <- read_csv("C:/Users/ashle/Documents/R/RX_Fire_Monitoring/RX_Fire_Monitoring/HolyGrail/data/raw/location_treatment.csv")






#Calculate Mass for FWD

HG_FWD_Mass <- HG_FWD_slope %>% 
      mutate(mass_1hr =(11.64 * count_x1h * 0.0151 * 	0.48 * 1.13 * slopecorrection)/ (2*3.28),
             mass_10hr=(11.64 * count_x10h * 0.289 * 	0.48 * 1.13 * slopecorrection) / (2*3.28),
             mass_100hr=(11.64 * count_x100h * 2.76 * 	0.40 * 1.13 * slopecorrection) / (4*3.28)) %>% 
      select(site_plotid_time_azimuth, mass_1hr, mass_10hr, mass_100hr, slopecorrection, avg_litter, avg_duff, avg_fueldepth)

#Combine CWD and FWD mass 
HG_CWD_FWD_combine <- left_join(HG_FWD_Mass, HG_CWD_complete, by="site_plotid_time_azimuth")
  

#Now calculate CWD mass with joined slope percent
HG_CWD_FWD_combine <- HG_CWD_FWD_combine %>% 
  replace_na(list(sound=0, rotten=0)) %>% 
  mutate(mass_cwd_sound =(11.64 * sound * 0.155 * 0.40 * slopecorrection) / (11.3*3.28),
         mass_cwd_rotten=(11.64 * rotten * 0.155 * 0.30 * slopecorrection) / (11.3*3.28)) %>%  
  separate(site_plotid_time_azimuth, c("site","plotid","year", "pre_post_fire","azimuth"), sep=" ") 
  
#average per plot

HG_CWD_FWD_plot <- HG_CWD_FWD_combine %>% 
  mutate(site_plotid_time = paste(site, plotid, year, pre_post_fire)) %>% 
  select(site_plotid_time, mass_1hr, mass_10hr, mass_100hr, mass_cwd_sound, mass_cwd_rotten, avg_litter, avg_duff, avg_fueldepth) %>% 
  group_by(site_plotid_time) %>% 
    summarise_all(mean, na.rm=TRUE)

HG_CWD_FWD_plot <- HG_CWD_FWD_plot %>% 
                    group_by(site_plotid_time) %>% 
                    mutate(total_fuel = sum(mass_1hr,mass_10hr,mass_100hr,mass_cwd_sound, mass_cwd_rotten)) %>% 
                    pivot_longer(cols = -site_plotid_time, names_to = "fuel_type_size", values_to= "mass_ton_acre") 
                  

#add column for Mg_Ha 

HG_CWD_FWD_plot <- HG_CWD_FWD_plot %>% 
  mutate(mass_mg_ha = (mass_ton_acre*0.446)) %>% 
  separate(site_plotid_time, c("site","plotid","year", "pre_post_fire"), sep=" ")
  

#save completed post fuels data frame
export(HG_CWD_FWD_plot, "C:/Users/ashle/Documents/R/RX_Fire_Monitoring/RX_Fire_Monitoring/HolyGrail/data/clean/HG_CWD_FWD_final.csv")

                      

```




```{r}




```

